<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>New Auction</title>
       
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style">
</head>
<div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/profile">B.A.S.S.</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/profile">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/auctions">Auctions
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/search">Search</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>
<br><br><br>
<div class="container">
    <div class="row">
        <div class="col-sm-12 mx-auto">
            <div class="card card-signin">
                <div class="card-body">
                    <h5 class="card-title">Requests</h5>
                    <div class="table-responsive scrollable">
                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col" id = "titleh">Title</th>
                                <th scope="col" id = "isbnh">ISBN</th>
                                <th scope="col" id = "authorh">Author</th>
                                <th scope="col" id = "descriptionh">Description</th>
                                <th scope="col" id = "conditionh">Condition</th>
                                <th scope="col" id = "genreh">Genre</th>
                                <th scope="col" id = "publisherh">Publisher</th>
                                <th scope="col" id = "enddateh">End Date</th>
                                <th scope="col" id = "binh">Buy it now</th>
                                <th scope="col" id = "minimumpriceh">Minimum Price</th>
                            </tr>
                            
                            </thead>
                            <tr>
                                <td scope="col" ><input id = "title" type = "text"/></td>
                                <td scope="col" ><input id = "isbn" type = "number" /></td>
                                <td scope="col" ><input id = "author" type ="text"/></td>
                                <td scope="col" ><input id = "description" type = "text"/></td>
                                <td scope="col" ><select id = "condition"></select></td>
                                <td scope="col" ><select id = "genre"></select></td>
                                <td scope="col" ><input id = "publisher" type = "text"/></td>
                                <td scope="col" ><input id = "enddate" type = "date"/></td>
                                <td scope="col" ><input id = "buyitnow" type = "number"/></td>
                                <td scope="col" ><input id = "minimumprice" type = "number"/></td>
                            </tr>
                            <tbody id="newAuctionTable"></tbody>
                        </table>
                        <input type = "button" value = "create auction" onclick = "auctionForm()">	
                    </div>
                </div>
            </div>                        
        </div>
    </div>
</div>

    <script rel = "text/javascript">
        function AjaxPost(url,body, func){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function (){
                if(this.readyState==4 && this.status == 200){
                    func(this);
                }
            }
            xhr.open("POST",url,true);
            xhr.setRequestHeader("Accept","application/json");
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(body);
        };

        function auctionForm(){
            var title  = document.getElementById("title");
            var isbn = document.getElementById("isbn");
            var author  = document.getElementById("author");
            var description = document.getElementById("description");
            var condition  = document.getElementById("condition");
            var publisher = document.getElementById("publisher");
            var date  = document.getElementById("enddate");
            var minimumPrice = document.getElementById("minimumprice");
            var buyItNow  = document.getElementById("buyitnow");
			var newAuction = {
            	"book":{
                "title":title.value,
                "isbn":isbn.valueAsNumber,
                "author":author.value,
                "description":description.value,
                "condition":condition.value,
                "publisher":publisher.value,
                "genres": [{"name":genre.options[genre.selectedIndex].innerText}],
                "condition":{"name":condition.options[condition.selectedIndex].innerText}
                },
	            "createDate":new Date().getTime(),
	            "endDate":enddate.valueAsNumber,
	            "user":{},
	            "minimumPrice":minimumPrice.valueAsNumber,
	            "buyItNow":buyItNow.valueAsNumber
				}
            console.log(newAuction);
            AjaxPost("auction/new",JSON.stringify(newAuction),function(xhr){
                console.log(xhr.responseText);
                });
        }
    </script>
    
    <script rel = "text/javascript">
    function AjaxGet(url, func) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                func(this);
            }
        }
        xhr.open("GET", url, true);
        xhr.send();
    };
    	function populateSelectGenre(xhr){
    		var res = JSON.parse(xhr.responseText);
    		var genre = document.getElementById("genre");
    		res.forEach(function(element){
    			var op = document.createElement("option");
    			op.innerText = element.name;
    			genre.add(op);
    		});
    	};
    	function populateSelectCondition(xhr){
    		var res = JSON.parse(xhr.responseText);
    		var genre = document.getElementById("condition");
    		res.forEach(function(element){
    			var op = document.createElement("option");
    			op.innerText = element.name;
    			genre.add(op);
    		});
    	};
    	function onload(){
    		AjaxGet("genre/all",populateSelectGenre);
    		AjaxGet("bookCondition/all",populateSelectCondition);
    	};
    	onload();
    </script>
</body>

</html>